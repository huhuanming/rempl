{"version":3,"file":"index.js","sources":["../../../src/subscriber/browser/index.ts"],"sourcesContent":["/* eslint-env browser */\nimport { opener, parent } from '../../utils/global.js';\nimport { Subscriber } from '../../classes/Subscriber.js';\nimport { EventTransport } from '../../transport/event.js';\nimport { setOverlayVisible } from './disconnected-overlay/index.js';\n\nlet subscriber: Subscriber | null = null;\n\nfunction createSubscriber() {\n    subscriber = new Subscriber();\n\n    // default overlay\n    const connectedObservable = Object.assign(subscriber.connected, { defaultOverlay: true });\n    connectedObservable.link((connected) => {\n        if (connected) {\n            setOverlayVisible(false);\n        } else if (connectedObservable.defaultOverlay) {\n            setOverlayVisible(true);\n        }\n    });\n\n    // link to transport\n    EventTransport.get('rempl-subscriber', 'rempl-sandbox', opener || parent).sync(subscriber);\n\n    return subscriber;\n}\n\nexport function getSubscriber() {\n    if (subscriber === null) {\n        subscriber = createSubscriber();\n    }\n\n    return Object.assign(subscriber.ns('*'), {\n        connected: subscriber.connected,\n        ns: subscriber.ns.bind(subscriber),\n    });\n}\n\nexport function getSelfSubscriber(id: string) {\n    const subscriber = new Subscriber(id);\n\n    EventTransport.get('rempl-self-subscriber', 'rempl-self-publisher').sync(subscriber);\n\n    return Object.assign(subscriber.ns('*'), {\n        connected: subscriber.connected,\n        ns: subscriber.ns.bind(subscriber),\n    });\n}\n"],"names":["opener","parent"],"mappings":";;;;;AAAA;AAKA;AACA,IAAA,UAAA,GAAA,IAAA,CAAA;AACA;AACA,SAAA,gBAAA,GAAA;AACA,IAAA,UAAA,GAAA,IAAA,UAAA,EAAA,CAAA;AACA;AACA;AACA,IAAA,MAAA,mBAAA,GAAA,MAAA,CAAA,MAAA,CAAA,UAAA,CAAA,SAAA,EAAA,EAAA,cAAA,EAAA,IAAA,EAAA,CAAA,CAAA;AACA,IAAA,mBAAA,CAAA,IAAA,CAAA,CAAA,SAAA,KAAA;AACA,QAAA,IAAA,SAAA,EAAA;AACA,YAAA,iBAAA,CAAA,KAAA,CAAA,CAAA;AACA,SAAA,MAAA,IAAA,mBAAA,CAAA,cAAA,EAAA;AACA,YAAA,iBAAA,CAAA,IAAA,CAAA,CAAA;AACA,SAAA;AACA,KAAA,CAAA,CAAA;AACA;AACA;AACA,IAAA,cAAA,CAAA,GAAA,CAAA,kBAAA,EAAA,eAAA,EAAAA,cAAA,IAAAC,cAAA,CAAA,CAAA,IAAA,CAAA,UAAA,CAAA,CAAA;AACA;AACA,IAAA,OAAA,UAAA,CAAA;AACA,CAAA;AACA;AACA,SAAA,aAAA,GAAA;AACA,IAAA,IAAA,UAAA,KAAA,IAAA,EAAA;AACA,QAAA,UAAA,GAAA,gBAAA,EAAA,CAAA;AACA,KAAA;AACA;AACA,IAAA,OAAA,MAAA,CAAA,MAAA,CAAA,UAAA,CAAA,EAAA,CAAA,GAAA,CAAA,EAAA;AACA,QAAA,SAAA,EAAA,UAAA,CAAA,SAAA;AACA,QAAA,EAAA,EAAA,UAAA,CAAA,EAAA,CAAA,IAAA,CAAA,UAAA,CAAA;AACA,KAAA,CAAA,CAAA;AACA,CAAA;AACA;AACA,SAAA,iBAAA,CAAA,EAAA,EAAA;AACA,IAAA,MAAA,UAAA,GAAA,IAAA,UAAA,CAAA,EAAA,CAAA,CAAA;AACA;AACA,IAAA,cAAA,CAAA,GAAA,CAAA,uBAAA,EAAA,sBAAA,CAAA,CAAA,IAAA,CAAA,UAAA,CAAA,CAAA;AACA;AACA,IAAA,OAAA,MAAA,CAAA,MAAA,CAAA,UAAA,CAAA,EAAA,CAAA,GAAA,CAAA,EAAA;AACA,QAAA,SAAA,EAAA,UAAA,CAAA,SAAA;AACA,QAAA,EAAA,EAAA,UAAA,CAAA,EAAA,CAAA,IAAA,CAAA,UAAA,CAAA;AACA,KAAA,CAAA,CAAA;AACA;;;;"}