{"version":3,"file":"ReactiveValue.js","sources":["../../src/classes/ReactiveValue.ts"],"sourcesContent":["export type OnChangeCallback<TContext, T> = (this: TContext, value: T) => void;\nexport type Handler<T> = {\n    fn(value: T): void;\n    context: unknown;\n    handler: Handler<T> | null;\n};\n\nexport class ReactiveValue<T> {\n    value: T;\n    handler: Handler<T> | null = null;\n\n    constructor(value: T) {\n        this.value = value;\n    }\n\n    /**\n     * Set new value and call apply method if value has been changed.\n     */\n    set(value: T): void {\n        if (!Object.is(this.value, value)) {\n            this.value = value;\n            this.apply();\n        }\n    }\n\n    /**\n     * Returns current token value.\n     */\n    get(): T {\n        return this.value;\n    }\n\n    /**\n     * Adds a callback on token value changes.\n     */\n    on<TContext>(fn: OnChangeCallback<TContext, T>, context?: TContext): void {\n        let cursor = this.handler;\n\n        while (cursor !== null) {\n            if (cursor.fn === fn && cursor.context === context) {\n                console.warn('ReactiveValue#on: duplicate fn & context pair');\n            }\n\n            cursor = cursor.handler;\n        }\n\n        this.handler = {\n            fn,\n            context,\n            handler: this.handler,\n        };\n    }\n\n    /**\n     * Adds a callback on token value changes and invokes callback with current value.\n     */\n    link<TContext>(fn: OnChangeCallback<TContext, T>, context?: TContext): void {\n        this.on(fn, context);\n        fn.call(context as TContext, this.value);\n    }\n\n    /**\n     * Removes a callback. Must be passed the same arguments as for ReactiveValue#on() method.\n     */\n    off<TContext>(fn: OnChangeCallback<TContext, T>, context?: TContext): void {\n        // todo rework\n        let cursor = this.handler;\n        let prev: Handler<T> | this = this;\n\n        while (cursor !== null) {\n            if (cursor.fn === fn && cursor.context === context) {\n                // make it non-callable\n                cursor.fn = function () {};\n\n                // remove from list\n                prev.handler = cursor.handler;\n\n                return;\n            }\n\n            prev = cursor;\n            cursor = cursor.handler;\n        }\n\n        console.warn('ReactiveValue#off: fn & context pair not found, nothing was removed');\n    }\n\n    /**\n     * Call all callbacks with current token value.\n     */\n    apply(): void {\n        // todo rework\n        let cursor = this.handler;\n\n        while (cursor !== null) {\n            cursor.fn.call(cursor.context, this.value);\n            cursor = cursor.handler;\n        }\n    }\n}\n"],"names":[],"mappings":"AAOA,MAAA,aAAA,CAAA;AACA,IAAA,KAAA,CAAA;AACA,IAAA,OAAA,GAAA,IAAA,CAAA;AACA;AACA,IAAA,WAAA,CAAA,KAAA,EAAA;AACA,QAAA,IAAA,CAAA,KAAA,GAAA,KAAA,CAAA;AACA,KAAA;AACA;AACA;AACA;AACA;AACA,IAAA,GAAA,CAAA,KAAA,EAAA;AACA,QAAA,IAAA,CAAA,MAAA,CAAA,EAAA,CAAA,IAAA,CAAA,KAAA,EAAA,KAAA,CAAA,EAAA;AACA,YAAA,IAAA,CAAA,KAAA,GAAA,KAAA,CAAA;AACA,YAAA,IAAA,CAAA,KAAA,EAAA,CAAA;AACA,SAAA;AACA,KAAA;AACA;AACA;AACA;AACA;AACA,IAAA,GAAA,GAAA;AACA,QAAA,OAAA,IAAA,CAAA,KAAA,CAAA;AACA,KAAA;AACA;AACA;AACA;AACA;AACA,IAAA,EAAA,CAAA,EAAA,EAAA,OAAA,EAAA;AACA,QAAA,IAAA,MAAA,GAAA,IAAA,CAAA,OAAA,CAAA;AACA;AACA,QAAA,OAAA,MAAA,KAAA,IAAA,EAAA;AACA,YAAA,IAAA,MAAA,CAAA,EAAA,KAAA,EAAA,IAAA,MAAA,CAAA,OAAA,KAAA,OAAA,EAAA;AACA,gBAAA,OAAA,CAAA,IAAA,CAAA,+CAAA,CAAA,CAAA;AACA,aAAA;AACA;AACA,YAAA,MAAA,GAAA,MAAA,CAAA,OAAA,CAAA;AACA,SAAA;AACA;AACA,QAAA,IAAA,CAAA,OAAA,GAAA;AACA,YAAA,EAAA;AACA,YAAA,OAAA;AACA,YAAA,OAAA,EAAA,IAAA,CAAA,OAAA;AACA,SAAA,CAAA;AACA,KAAA;AACA;AACA;AACA;AACA;AACA,IAAA,IAAA,CAAA,EAAA,EAAA,OAAA,EAAA;AACA,QAAA,IAAA,CAAA,EAAA,CAAA,EAAA,EAAA,OAAA,CAAA,CAAA;AACA,QAAA,EAAA,CAAA,IAAA,CAAA,OAAA,GAAA,IAAA,CAAA,KAAA,CAAA,CAAA;AACA,KAAA;AACA;AACA;AACA;AACA;AACA,IAAA,GAAA,CAAA,EAAA,EAAA,OAAA,EAAA;AACA;AACA,QAAA,IAAA,MAAA,GAAA,IAAA,CAAA,OAAA,CAAA;AACA,QAAA,IAAA,IAAA,GAAA,IAAA,CAAA;AACA;AACA,QAAA,OAAA,MAAA,KAAA,IAAA,EAAA;AACA,YAAA,IAAA,MAAA,CAAA,EAAA,KAAA,EAAA,IAAA,MAAA,CAAA,OAAA,KAAA,OAAA,EAAA;AACA;AACA,gBAAA,MAAA,CAAA,EAAA,GAAA,YAAA,EAAA,CAAA;AACA;AACA;AACA,gBAAA,IAAA,CAAA,OAAA,GAAA,MAAA,CAAA,OAAA,CAAA;AACA;AACA,gBAAA,OAAA;AACA,aAAA;AACA;AACA,YAAA,IAAA,GAAA,MAAA,CAAA;AACA,YAAA,MAAA,GAAA,MAAA,CAAA,OAAA,CAAA;AACA,SAAA;AACA;AACA,QAAA,OAAA,CAAA,IAAA,CAAA,qEAAA,CAAA,CAAA;AACA,KAAA;AACA;AACA;AACA;AACA;AACA,IAAA,KAAA,GAAA;AACA;AACA,QAAA,IAAA,MAAA,GAAA,IAAA,CAAA,OAAA,CAAA;AACA;AACA,QAAA,OAAA,MAAA,KAAA,IAAA,EAAA;AACA,YAAA,MAAA,CAAA,EAAA,CAAA,IAAA,CAAA,MAAA,CAAA,OAAA,EAAA,IAAA,CAAA,KAAA,CAAA,CAAA;AACA,YAAA,MAAA,GAAA,MAAA,CAAA,OAAA,CAAA;AACA,SAAA;AACA,KAAA;AACA;;;;"}