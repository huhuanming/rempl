{"version":3,"file":"view.js","sources":["../../../src/host/in-page/view.ts"],"sourcesContent":["/* eslint-env browser */\n\nimport { trustedEmptyHTML } from '../../utils/index.js';\nimport createElement from './createElement.js';\nimport styles from './style.js';\n\ntype Side = 'left' | 'top' | 'bottom' | 'right' | 'fit the page';\ntype View = {\n    wrapper: HTMLElement;\n    element: HTMLElement;\n    tabs: HTMLElement;\n    buttons: HTMLElement;\n    sandbox: HTMLElement;\n};\n\nlet publishers: string[] = [];\nlet selectedPublisher: string | null = null;\nlet selectPublisher: (id?: string) => void = () => {};\nlet view: View | null = null;\nlet onClose: () => void;\n\n// settings persistance\nconst settings: Record<string, any> = {};\n\nfunction setSetting(name: string, value: any) {\n    settings[name] = value;\n    try {\n        localStorage.rempl = JSON.stringify(settings);\n    } catch (e) {}\n}\n\nfunction updateTabSelectedState(tabEl: HTMLElement) {\n    tabEl.classList.toggle('tab_selected', tabEl.getAttribute('publisher') === selectedPublisher);\n}\n\nfunction updatePublisherList() {\n    const { tabs } = getView();\n\n    tabs.innerHTML = trustedEmptyHTML;\n\n    for (const publisher of publishers) {\n        const { element } = createElement({\n            publisher,\n            class: 'tab',\n            children: [publisher],\n            events: {\n                click() {\n                    selectPublisher(publisher);\n                },\n            },\n        });\n\n        updateTabSelectedState(element);\n        tabs.appendChild(element);\n    }\n}\n\nfunction getView(): View {\n    if (view === null) {\n        const wrapperEl = document.createElement('div');\n        const shadow = wrapperEl.attachShadow({ mode: 'open' });\n        const styleEl = document.createElement('style');\n        const content = createElement({\n            class: 'host',\n            children: [\n                {\n                    class: 'toolbar',\n                    children: [\n                        {\n                            ref: 'tabs',\n                            style: {\n                                display: 'flex',\n                                flex: '1',\n                            },\n                        },\n                        {\n                            ref: 'buttons',\n                            class: 'layout-buttons',\n                            children: [\n                                ...(\n                                    ['left', 'top', 'bottom', 'right', 'fit the page'] as Side[]\n                                ).map((side: Side) => ({\n                                    side,\n                                    title: `Dock to ${side}`,\n                                    class: 'layout-button',\n                                    events: {\n                                        click() {\n                                            wrapperEl.setAttribute('side', side);\n                                            setSetting('host-dock', side);\n                                        },\n                                    },\n                                })),\n                                {\n                                    class: 'close-button',\n                                    events: {\n                                        click() {\n                                            onClose?.();\n                                        },\n                                    },\n                                },\n                            ],\n                        },\n                    ],\n                },\n                {\n                    ref: 'sandbox',\n                    class: 'sandbox',\n                },\n            ],\n        });\n\n        try {\n            Object.assign(settings, JSON.parse(localStorage.rempl || '{}'));\n        } catch (e) {}\n\n        wrapperEl.setAttribute('side', settings['host-dock'] || 'bottom');\n        styleEl.append(document.createTextNode(styles));\n        shadow.append(styleEl);\n        shadow.append(content.element);\n\n        view = {\n            wrapper: wrapperEl,\n            ...content,\n        };\n        updatePublisherList();\n    }\n\n    return view;\n}\n\nfunction showView(closeCallback: () => void): void {\n    const { wrapper } = getView();\n\n    onClose = closeCallback;\n\n    wrapper.style.display = '';\n    if (!document.contains(wrapper)) {\n        (document.body || document.documentElement).append(wrapper);\n    }\n}\n\nfunction softHideView(): void {\n    getView().wrapper.style.display = 'none';\n}\n\nfunction hideView(): void {\n    getView().wrapper.remove();\n}\n\nexport default {\n    show: showView,\n    hide: hideView,\n    softHide: softHideView,\n    getSandboxContainer() {\n        return getView().sandbox;\n    },\n    setPublisherList(publisherList: string[], selectPublisherFn: (id?: string) => void) {\n        publishers = publisherList;\n        selectPublisher = selectPublisherFn;\n        updatePublisherList();\n    },\n    selectPublisher(id: string) {\n        if (selectedPublisher !== id) {\n            selectedPublisher = id;\n\n            if (view) {\n                Array.from(getView().tabs.children).forEach((el) =>\n                    updateTabSelectedState(el as HTMLElement)\n                );\n            }\n        }\n    },\n};\n"],"names":[],"mappings":"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"}